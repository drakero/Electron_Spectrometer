#Module containing frequently used physics constants and functions

import math
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
from matplotlib.colors import ListedColormap

#%%
#==============================================================================
# Fundamental constants
#==============================================================================
me = 9.10938*10**-31 #Electron mass in kg
mp = 1.67262158*10**-27 #Proton mass in kg
q = 1.602177*10**-19 #Elementary charge in C
G = 6.674*10**-11 #Gravitational constant in N*m^2/kg^2
c = 2.998*10**8 #Speed of light in m/s
epsilon0 = 8.854*10**-12 #Electric constant in F/m
mu0 = 4*math.pi*10**-7 #Magnetic constant in T*m/A
hbar = 1.054572*10**-34 #Reduced Planck constant in J*s
kb = 1.38065*10**-23 #Boltzmann constant in J/K
NA = 6.022*10**23 #Avagadro's number


#%%
#==============================================================================
# Functions
#==============================================================================

def savitzky_golay(y, window_size, order, deriv=0, rate=1):
    """Smooth (and optionally differentiate) data with a Savitzky-Golay filter.
    
    y : array_like, shape (N,)
        the values of the time history of the signal.
    window_size : int
        the length of the window. Must be an odd integer number.
    order : int
        the order of the polynomial used in the filtering.
        Must be less then `window_size` - 1.
    deriv: int
        the order of the derivative to compute (default = 0 means only smoothing)
    Returns
    -------
    ys : ndarray, shape (N)
        the smoothed signal (or it's n-th derivative)."""
    
    try:
        window_size = np.abs(np.int(window_size))
        order = np.abs(np.int(order))
    except ValueError:#, msg:
        raise ValueError("window_size and order have to be of type int")
    if window_size % 2 != 1 or window_size < 1:
        raise TypeError("window_size size must be a positive odd number")
    if window_size < order + 2:
        raise TypeError("window_size is too small for the polynomials order")
    order_range = range(order+1)
    half_window = (window_size -1) // 2
    # precompute coefficients
    b = np.mat([[k**i for i in order_range] for k in range(-half_window, half_window+1)])
    m = np.linalg.pinv(b).A[deriv] * rate**deriv * math.factorial(deriv)
    # pad the signal at the extremes with
    # values taken from the signal itself
    firstvals = y[0] - np.abs( y[1:half_window+1][::-1] - y[0] )
    lastvals = y[-1] + np.abs(y[-half_window-1:-1][::-1] - y[-1])
    y = np.concatenate((firstvals, y, lastvals))
    return np.convolve( m[::-1], y, mode='valid')


def Sellmeier(wavelength,B1,C1,B2,C2,B3,C3):
    """Calculates the refractive index of a material given the wavelength in
    microns and the Sellmeier coefficients."""
    nsqaured = 1 + B1*wavelength**2/(wavelength**2-C1) + \
    B2*wavelength**2/(wavelength**2-C2) + \
    B3*wavelength**2/(wavelength**2-C3)
    
    return math.sqrt(nsqaured)

#%%
#==============================================================================
# Colormaps
#==============================================================================
cm_data = [[  5.47748087e-04,  3.06077876e-04,  5.99659709e-04],
           [  1.53644587e-03,  8.42655550e-04,  1.34529274e-03],
           [  3.01784633e-03,  1.58023250e-03,  2.32542855e-03],
           [  4.99694751e-03,  2.49381178e-03,  3.50796236e-03],
           [  7.48481708e-03,  3.56440966e-03,  4.87088052e-03],
           [  1.04960883e-02,  4.77613919e-03,  6.39708202e-03],
           [  1.40319020e-02,  6.12063556e-03,  8.07683812e-03],
           [  1.81005129e-02,  7.58879644e-03,  9.90074451e-03],
           [  2.27332706e-02,  9.16464713e-03,  1.18540110e-02],
           [  2.79272650e-02,  1.08453847e-02,  1.39330790e-02],
           [  3.36872542e-02,  1.26262306e-02,  1.61330271e-02],
           [  4.00368926e-02,  1.44963409e-02,  1.84439042e-02],
           [  4.66104510e-02,  1.64449249e-02,  2.08558583e-02],
           [  5.31296479e-02,  1.84753128e-02,  2.33711881e-02],
           [  5.96057496e-02,  2.05831211e-02,  2.59856788e-02],
           [  6.60845032e-02,  2.27438317e-02,  2.86779070e-02],
           [  7.25294283e-02,  2.49708228e-02,  3.14589446e-02],
           [  7.89435396e-02,  2.72607146e-02,  3.43255418e-02],
           [  8.53596773e-02,  2.95919033e-02,  3.72588722e-02],
           [  9.17638550e-02,  3.19685783e-02,  4.02622187e-02],
           [  9.81451315e-02,  3.43953187e-02,  4.32336100e-02],
           [  1.04526807e-01,  3.68537652e-02,  4.61338626e-02],
           [  1.10912754e-01,  3.93370692e-02,  4.89670842e-02],
           [  1.17281155e-01,  4.18213190e-02,  5.17490035e-02],
           [  1.23649104e-01,  4.42314110e-02,  5.44728326e-02],
           [  1.30032724e-01,  4.65668264e-02,  5.71315659e-02],
           [  1.36402526e-01,  4.88536577e-02,  5.97450927e-02],
           [  1.42772901e-01,  5.10827707e-02,  6.23071284e-02],
           [  1.49165802e-01,  5.32377393e-02,  6.48060493e-02],
           [  1.55547516e-01,  5.53486340e-02,  6.72644498e-02],
           [  1.61933457e-01,  5.74043288e-02,  6.96745252e-02],
           [  1.68344281e-01,  5.93881217e-02,  7.20244566e-02],
           [  1.74745763e-01,  6.13314167e-02,  7.43375755e-02],
           [  1.81158328e-01,  6.32175014e-02,  7.66020013e-02],
           [  1.87593551e-01,  6.50366459e-02,  7.88110281e-02],
           [  1.94020688e-01,  6.68182091e-02,  8.09862510e-02],
           [  2.00469427e-01,  6.85354715e-02,  8.31086225e-02],
           [  2.06933861e-01,  7.01944599e-02,  8.51828223e-02],
           [  2.13391007e-01,  7.18183162e-02,  8.72257169e-02],
           [  2.19884314e-01,  7.33649880e-02,  8.92074450e-02],
           [  2.26381434e-01,  7.48667722e-02,  9.11513888e-02],
           [  2.32877958e-01,  7.63290713e-02,  9.30615611e-02],
           [  2.39417030e-01,  7.77075993e-02,  9.49068218e-02],
           [  2.45949187e-01,  7.90539524e-02,  9.67239312e-02],
           [  2.52503045e-01,  8.03383569e-02,  9.84920739e-02],
           [  2.59078620e-01,  8.15605334e-02,  1.00211332e-01],
           [  2.65647177e-01,  8.27523320e-02,  1.01904143e-01],
           [  2.72264658e-01,  8.38512497e-02,  1.03527192e-01],
           [  2.78877454e-01,  8.49173592e-02,  1.05122465e-01],
           [  2.85511685e-01,  8.59209086e-02,  1.06669513e-01],
           [  2.92169537e-01,  8.68587180e-02,  1.08166407e-01],
           [  2.98823804e-01,  8.77631553e-02,  1.09635484e-01],
           [  3.05527253e-01,  8.85696990e-02,  1.11032921e-01],
           [  3.12221950e-01,  8.93488570e-02,  1.12406908e-01],
           [  3.18954132e-01,  9.00424249e-02,  1.13718186e-01],
           [  3.25693760e-01,  9.06876495e-02,  1.14992114e-01],
           [  3.32453378e-01,  9.12678184e-02,  1.16217615e-01],
           [  3.39237731e-01,  9.17755190e-02,  1.17389984e-01],
           [  3.46027836e-01,  9.22355630e-02,  1.18525855e-01],
           [  3.52856378e-01,  9.26018738e-02,  1.19595002e-01],
           [  3.59679944e-01,  9.29340598e-02,  1.20636788e-01],
           [  3.66551779e-01,  9.31548660e-02,  1.21600901e-01],
           [  3.73411664e-01,  9.33503825e-02,  1.22543527e-01],
           [  3.80325509e-01,  9.34213548e-02,  1.23400666e-01],
           [  3.87224407e-01,  9.34702358e-02,  1.24238410e-01],
           [  3.94178548e-01,  9.33868762e-02,  1.24986526e-01],
           [  4.01118932e-01,  9.32779221e-02,  1.25712996e-01],
           [  4.08111186e-01,  9.30356254e-02,  1.26349950e-01],
           [  4.15095232e-01,  9.27563247e-02,  1.26958059e-01],
           [  4.22122894e-01,  9.23504646e-02,  1.27481649e-01],
           [  4.29152396e-01,  9.18869215e-02,  1.27963592e-01],
           [  4.36212185e-01,  9.13129690e-02,  1.28371575e-01],
           [  4.43288441e-01,  9.06498445e-02,  1.28718807e-01],
           [  4.50376440e-01,  8.99035348e-02,  1.29008926e-01],
           [  4.57500122e-01,  8.90240166e-02,  1.29212149e-01],
           [  4.64621315e-01,  8.80820507e-02,  1.29370675e-01],
           [  4.71782712e-01,  8.69874039e-02,  1.29431311e-01],
           [  4.78953140e-01,  8.57983354e-02,  1.29428443e-01],
           [  4.86129742e-01,  8.45174521e-02,  1.29363265e-01],
           [  4.93347856e-01,  8.30602174e-02,  1.29187411e-01],
           [  5.00568348e-01,  8.15074000e-02,  1.28946985e-01],
           [  5.07795622e-01,  7.98442895e-02,  1.28633086e-01],
           [  5.15061443e-01,  7.79847171e-02,  1.28197778e-01],
           [  5.22331370e-01,  7.60042039e-02,  1.27682677e-01],
           [  5.29606493e-01,  7.38929257e-02,  1.27081517e-01],
           [  5.36898464e-01,  7.16095269e-02,  1.26371292e-01],
           [  5.44210979e-01,  6.91294145e-02,  1.25538480e-01],
           [  5.51527384e-01,  6.64871150e-02,  1.24600175e-01],
           [  5.58847543e-01,  6.36701807e-02,  1.23548101e-01],
           [  5.66170867e-01,  6.06655849e-02,  1.22373321e-01],
           [  5.73496198e-01,  5.74600225e-02,  1.21066243e-01],
           [  5.80823155e-01,  5.40347259e-02,  1.19613893e-01],
           [  5.88150809e-01,  5.03692587e-02,  1.18001618e-01],
           [  5.95468514e-01,  4.64809002e-02,  1.16230934e-01],
           [  6.02771410e-01,  4.23662137e-02,  1.14290578e-01],
           [  6.10053697e-01,  3.80294354e-02,  1.12167999e-01],
           [  6.17315053e-01,  3.36821518e-02,  1.09833536e-01],
           [  6.24540275e-01,  2.94772673e-02,  1.07285752e-01],
           [  6.31717080e-01,  2.54981926e-02,  1.04512903e-01],
           [  6.38830845e-01,  2.18456231e-02,  1.01504057e-01],
           [  6.45869143e-01,  1.86152455e-02,  9.82344630e-02],
           [  6.52820000e-01,  1.59074618e-02,  9.46637537e-02],
           [  6.59646391e-01,  1.39587650e-02,  9.08291206e-02],
           [  6.66337846e-01,  1.28797857e-02,  8.66610902e-02],
           [  6.72852150e-01,  1.29508575e-02,  8.22139934e-02],
           [  6.79165725e-01,  1.43662850e-02,  7.74620521e-02],
           [  6.85245344e-01,  1.73724470e-02,  7.24432935e-02],
           [  6.91064162e-01,  2.21812700e-02,  6.72044508e-02],
           [  6.96604313e-01,  2.89518804e-02,  6.17956273e-02],
           [  7.01858034e-01,  3.77785476e-02,  5.62767487e-02],
           [  7.06828946e-01,  4.81077524e-02,  5.07103160e-02],
           [  7.11530852e-01,  5.87396608e-02,  4.51509246e-02],
           [  7.15984104e-01,  6.94561728e-02,  3.96258938e-02],
           [  7.20211973e-01,  8.01198504e-02,  3.43668144e-02],
           [  7.24237819e-01,  9.06466389e-02,  2.96010227e-02],
           [  7.28087046e-01,  1.00974853e-01,  2.53199758e-02],
           [  7.31777099e-01,  1.11092460e-01,  2.14743407e-02],
           [  7.35324853e-01,  1.20992330e-01,  1.80324568e-02],
           [  7.38749986e-01,  1.30660611e-01,  1.49834554e-02],
           [  7.42058546e-01,  1.40125512e-01,  1.22768458e-02],
           [  7.45268541e-01,  1.49376147e-01,  9.91387703e-03],
           [  7.48380807e-01,  1.58446763e-01,  7.85197006e-03],
           [  7.51411961e-01,  1.67326772e-01,  6.09909211e-03],
           [  7.54360108e-01,  1.76048924e-01,  4.62255966e-03],
           [  7.57235438e-01,  1.84613826e-01,  3.42361090e-03],
           [  7.60041495e-01,  1.93035357e-01,  2.49239069e-03],
           [  7.62779423e-01,  2.01329553e-01,  1.81912945e-03],
           [  7.65457394e-01,  2.09496673e-01,  1.40868712e-03],
           [  7.68075387e-01,  2.17551534e-01,  1.25464458e-03],
           [  7.70634609e-01,  2.25504578e-01,  1.35552563e-03],
           [  7.73139048e-01,  2.33360100e-01,  1.71537405e-03],
           [  7.75591948e-01,  2.41122972e-01,  2.33824343e-03],
           [  7.77992056e-01,  2.48804382e-01,  3.22460569e-03],
           [  7.80340998e-01,  2.56409762e-01,  4.37981012e-03],
           [  7.82640876e-01,  2.63943166e-01,  5.81064704e-03],
           [  7.84894356e-01,  2.71407361e-01,  7.52509413e-03],
           [  7.87100025e-01,  2.78810409e-01,  9.52884640e-03],
           [  7.89258842e-01,  2.86156297e-01,  1.18306809e-02],
           [  7.91371647e-01,  2.93448741e-01,  1.44401503e-02],
           [  7.93439582e-01,  3.00690679e-01,  1.73677654e-02],
           [  7.95463974e-01,  3.07884524e-01,  2.06247965e-02],
           [  7.97443965e-01,  3.15035091e-01,  2.42224298e-02],
           [  7.99380049e-01,  3.22145136e-01,  2.81733908e-02],
           [  8.01272655e-01,  3.29217234e-01,  3.24912000e-02],
           [  8.03122155e-01,  3.36253788e-01,  3.71901909e-02],
           [  8.04929101e-01,  3.43256788e-01,  4.22313575e-02],
           [  8.06693679e-01,  3.50228445e-01,  4.73204319e-02],
           [  8.08415707e-01,  3.57171169e-01,  5.24362150e-02],
           [  8.10095390e-01,  3.64086767e-01,  5.75815505e-02],
           [  8.11732900e-01,  3.70976931e-01,  6.27592531e-02],
           [  8.13328386e-01,  3.77843239e-01,  6.79721011e-02],
           [  8.14881914e-01,  3.84687219e-01,  7.32228505e-02],
           [  8.16393162e-01,  3.91510654e-01,  7.85143534e-02],
           [  8.17862434e-01,  3.98314597e-01,  8.38492479e-02],
           [  8.19289808e-01,  4.05100228e-01,  8.92301944e-02],
           [  8.20675356e-01,  4.11868642e-01,  9.46598270e-02],
           [  8.22019147e-01,  4.18620850e-01,  1.00140759e-01],
           [  8.23321076e-01,  4.25357937e-01,  1.05675673e-01],
           [  8.24579971e-01,  4.32081810e-01,  1.11267807e-01],
           [  8.25797022e-01,  4.38792265e-01,  1.16919256e-01],
           [  8.26972318e-01,  4.45490004e-01,  1.22632628e-01],
           [  8.28105969e-01,  4.52175661e-01,  1.28410536e-01],
           [  8.29198106e-01,  4.58849799e-01,  1.34255600e-01],
           [  8.30246845e-01,  4.65514496e-01,  1.40171719e-01],
           [  8.31253477e-01,  4.72169257e-01,  1.46160961e-01],
           [  8.32218825e-01,  4.78813958e-01,  1.52225658e-01],
           [  8.33143166e-01,  4.85448877e-01,  1.58368510e-01],
           [  8.34026337e-01,  4.92074575e-01,  1.64592581e-01],
           [  8.34865726e-01,  4.98693308e-01,  1.70902788e-01],
           [  8.35664916e-01,  5.05302826e-01,  1.77299785e-01],
           [  8.36424449e-01,  5.11903106e-01,  1.83786355e-01],
           [  8.37144349e-01,  5.18494457e-01,  1.90365756e-01],
           [  8.37821386e-01,  5.25079315e-01,  1.97043949e-01],
           [  8.38460593e-01,  5.31654527e-01,  2.03820580e-01],
           [  8.39062934e-01,  5.38219741e-01,  2.10698438e-01],
           [  8.39625786e-01,  5.44776874e-01,  2.17683451e-01],
           [  8.40151464e-01,  5.51324619e-01,  2.24777630e-01],
           [  8.40643694e-01,  5.57860868e-01,  2.31981740e-01],
           [  8.41100710e-01,  5.64386920e-01,  2.39301446e-01],
           [  8.41523874e-01,  5.70902112e-01,  2.46739858e-01],
           [  8.41918660e-01,  5.77403408e-01,  2.54296285e-01],
           [  8.42282318e-01,  5.83892628e-01,  2.61977819e-01],
           [  8.42619551e-01,  5.90367262e-01,  2.69784618e-01],
           [  8.42934948e-01,  5.96824995e-01,  2.77716799e-01],
           [  8.43224874e-01,  6.03268082e-01,  2.85782909e-01],
           [  8.43499590e-01,  6.09691202e-01,  2.93977283e-01],
           [  8.43757426e-01,  6.16095589e-01,  3.02306589e-01],
           [  8.44004819e-01,  6.22478199e-01,  3.10768886e-01],
           [  8.44245148e-01,  6.28837705e-01,  3.19365364e-01],
           [  8.44481740e-01,  6.35172863e-01,  3.28097209e-01],
           [  8.44721292e-01,  6.41480849e-01,  3.36961479e-01],
           [  8.44966060e-01,  6.47761126e-01,  3.45960220e-01],
           [  8.45224116e-01,  6.54010452e-01,  3.55088136e-01],
           [  8.45498073e-01,  6.60228304e-01,  3.64346261e-01],
           [  8.45795977e-01,  6.66411737e-01,  3.73728323e-01],
           [  8.46121480e-01,  6.72559954e-01,  3.83233168e-01],
           [  8.46481807e-01,  6.78670670e-01,  3.92854340e-01],
           [  8.46881608e-01,  6.84742875e-01,  4.02588183e-01],
           [  8.47327050e-01,  6.90775020e-01,  4.12428237e-01],
           [  8.47823192e-01,  6.96766155e-01,  4.22368839e-01],
           [  8.48375288e-01,  7.02715365e-01,  4.32403246e-01],
           [  8.48987971e-01,  7.08622093e-01,  4.42524818e-01],
           [  8.49665854e-01,  7.14485900e-01,  4.52726101e-01],
           [  8.50412432e-01,  7.20306865e-01,  4.63000588e-01],
           [  8.51231805e-01,  7.26084924e-01,  4.73339956e-01],
           [  8.52126044e-01,  7.31820833e-01,  4.83738473e-01],
           [  8.53098501e-01,  7.37514940e-01,  4.94187483e-01],
           [  8.54150182e-01,  7.43168472e-01,  5.04681709e-01],
           [  8.55282963e-01,  7.48782381e-01,  5.15213725e-01],
           [  8.56497845e-01,  7.54357945e-01,  5.25777086e-01],
           [  8.57794001e-01,  7.59897041e-01,  5.36368355e-01],
           [  8.59174105e-01,  7.65400439e-01,  5.46976883e-01],
           [  8.60633354e-01,  7.70871219e-01,  5.57606383e-01],
           [  8.62177083e-01,  7.76309374e-01,  5.68239986e-01],
           [  8.63798762e-01,  7.81718409e-01,  5.78884679e-01],
           [  8.65499273e-01,  7.87099604e-01,  5.89532223e-01],
           [  8.67278601e-01,  7.92454507e-01,  6.00175897e-01],
           [  8.69131487e-01,  7.97786038e-01,  6.10820444e-01],
           [  8.71059544e-01,  8.03095231e-01,  6.21455565e-01],
           [  8.73060264e-01,  8.08384190e-01,  6.32080042e-01],
           [  8.75129420e-01,  8.13655355e-01,  6.42696917e-01],
           [  8.77266957e-01,  8.18910094e-01,  6.53299775e-01],
           [  8.79472552e-01,  8.24149834e-01,  6.63882794e-01],
           [  8.81741135e-01,  8.29377026e-01,  6.74451794e-01],
           [  8.84071022e-01,  8.34593269e-01,  6.85004878e-01],
           [  8.86462613e-01,  8.39799688e-01,  6.95535194e-01],
           [  8.88914103e-01,  8.44997846e-01,  7.06041561e-01],
           [  8.91422030e-01,  8.50189563e-01,  7.16527439e-01],
           [  8.93985071e-01,  8.55376161e-01,  7.26991348e-01],
           [  8.96602050e-01,  8.60558878e-01,  7.37431857e-01],
           [  8.99273599e-01,  8.65738575e-01,  7.47843231e-01],
           [  9.01998246e-01,  8.70916447e-01,  7.58225729e-01],
           [  9.04774179e-01,  8.76093663e-01,  7.68581168e-01],
           [  9.07601077e-01,  8.81271057e-01,  7.78908134e-01],
           [  9.10478923e-01,  8.86449336e-01,  7.89205145e-01],
           [  9.13408065e-01,  8.91629065e-01,  7.99470615e-01],
           [  9.16389285e-01,  8.96810645e-01,  8.09702806e-01],
           [  9.19423884e-01,  9.01994289e-01,  8.19899754e-01],
           [  9.22514634e-01,  9.07179878e-01,  8.30056811e-01],
           [  9.25663625e-01,  9.12367240e-01,  8.40172912e-01],
           [  9.28874059e-01,  9.17555864e-01,  8.50245916e-01],
           [  9.32150713e-01,  9.22744823e-01,  8.60271610e-01],
           [  9.35499755e-01,  9.27932781e-01,  8.70244531e-01],
           [  9.38929005e-01,  9.33117947e-01,  8.80157433e-01],
           [  9.42448176e-01,  9.38298064e-01,  8.90000542e-01],
           [  9.46068952e-01,  9.43470490e-01,  8.99760543e-01],
           [  9.49804691e-01,  9.48632448e-01,  9.09419325e-01],
           [  9.53669300e-01,  9.53781607e-01,  9.18952702e-01],
           [  9.57674688e-01,  9.58917154e-01,  9.28329735e-01],
           [  9.61826200e-01,  9.64041451e-01,  9.37513981e-01],
           [  9.66116261e-01,  9.69161984e-01,  9.46468608e-01],
           [  9.70518526e-01,  9.74292574e-01,  9.55166618e-01],
           [  9.74987153e-01,  9.79452262e-01,  9.63603926e-01],
           [  9.79465063e-01,  9.84661130e-01,  9.71808036e-01],
           [  9.83898767e-01,  9.89934801e-01,  9.79834651e-01],
           [  9.88251024e-01,  9.95281008e-01,  9.87752805e-01]]
           
           
physics_heat = ListedColormap(cm_data, name='physics_heat')